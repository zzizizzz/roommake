<html layout:decorate="~{layout/base}">
<head>
    <title>ë£¸ë©”ì´í¬ :: ì»¤ë®¤ë‹ˆí‹°</title>
</head>
</head>
<div layout:fragment="content" class="container my-3">

    <!-- ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ ì‹œì‘ -->
    <div class="list-group p-3 mb-3">
        <form id="form-community" method="get" th:action="@{|/community/list/${commCatId}|}">
            <input type="hidden" name="page"/>
            <!-- ì§‘ë“¤ì´ ê¸€ ì „ì²´ ê°œìˆ˜, ì •ë ¬ ì˜µì…˜ -->
            <div class="row mt-5 mb-3">
                <div class="col-12">
                    <div class="d-flex justify-content-between">
                        <div class="align-text-bottom">
                            <h5>ì „ì²´ <strong style="color: cornflowerblue" th:text="${paging.totalRows}">77</strong></h5>
                        </div>
                        <div>
                            <select class="form-select" style="width:150px;" name="sort" onchange="changeSort()">
                                <option value="all" th:selected="${#strings.equals(param.sort, 'all')}">ì „ì²´</option>
                                <option value="date" th:selected="${#strings.equals(param.sort, 'date')}">ìµœì‹ ìˆœ</option>
                                <option value="like" th:selected="${#strings.equals(param.sort, 'like')}">ì¢‹ì•„ìš”ìˆ˜</option>
                                <option value="view" th:selected="${#strings.equals(param.sort, 'view')}">ì¡°íšŒìˆ˜</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row" th:if="${communityList.isEmpty()}">
                <div class="col-12 my-5 text-center">
                    <h4>ê²Œì‹œê¸€ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</h4>
                </div>
            </div>
            <div th:if="${!communityList.isEmpty()}">
                <th:block th:each="community : ${communityList}">
                    <a th:href="|/community/detail/${community.id}|" class="list-group-item list-group-item-action link-dark">
                        <div class="d-flex w-100 justify-content-between mb-3 pt-2">
                            <h6 class="mb-1 fw-bold" style="max-width: 936px;
                                                            height: 19px;
                                                            display: -webkit-box;
                                                            overflow: hidden;
                                                            text-overflow: ellipsis;
                                                            -webkit-box-orient: vertical;
                                                            -webkit-line-clamp: 1;" th:text="${community.title}">ì»¤ë®¤ë‹ˆí‹° ì œëª©</h6>
                            <small th:text="${#dates.format(community.createDate, 'yyyy-MM-dd')}">2024-01-01</small>
                        </div>
                        <div class="d-flex w-100 justify-content-start mb-3">
                            <img class="float-start img-thumbnail me-3" style="width: 130px; height: 130px; object-fit: cover;"
                                 alt="..." th:src="@{${community.imageName}}">
                            <p class="mb-1 text-secondary" style="height: 76px;
                                                                  display: -webkit-box;
                                                                  overflow: hidden;
                                                                  text-overflow: ellipsis;
                                                                  -webkit-box-orient: vertical;
                                                                  -webkit-line-clamp: 3;" id="communityContent">
                                <script th:inline="javascript">
                                    /* Thymeleafì—ì„œ content ë³€ìˆ˜ë¥¼ ê°€ì ¸ì™€ì„œ JavaScript ë³€ìˆ˜ì— í• ë‹¹ */
                                    var content = /*[[${community.content}]]*/'';
                                    /* HTML íƒœê·¸ë¥¼ ì œê±°í•˜ëŠ” ì •ê·œì‹ */
                                    var contentWithoutTags = content.replace(/<[^>]+>/g, '');
                                    /* íƒœê·¸ê°€ ì œê±°ëœ ë‚´ìš©ì„ ì¶œë ¥ */
                                    document.write(contentWithoutTags);
                                </script>
                            </p>
                        </div>
                        <div class="d-flex w-100 justify-content-between mb-2">
                            <div>
                                <small class="fw-bold" th:text="${community.user.nickname}">í™ê¸¸ë™</small>
                            </div>
                            <div>
                                <small>ğŸ‘€</small>
                                <small th:text="${community.viewCount}">7</small>
                                <small>|</small>
                                <small>â¤ï¸</small>
                                <small th:text="${community.likeCount}">7</small>
                            </div>
                        </div>
                    </a>
                </th:block>
            </div>

            <!-- ê²€ìƒ‰, ê¸€ì“°ê¸° ë²„íŠ¼ ì˜ì—­ -->
            <div class="d-flex justify-content-between my-3">
                <!-- ê²€ìƒ‰ ì˜ì—­ -->
                <div class="row row-cols-sm-auto justify-content-start align-items-center">
                    <div class="col-12">
                        <select class="form-select" name="opt">
                            <option value="all" th:selected="${#strings.equals(param.opt, 'all')}">ì „ì²´</option>
                            <option value="title" th:selected="${#strings.equals(param.opt, 'title')}">ì œëª©</option>
                            <option value="content" th:selected="${#strings.equals(param.opt, 'content')}">ë‚´ìš©</option>
                        </select>
                    </div>
                    <div class="col-12">
                        <input type="text" class="form-control" name="keyword" th:value="${param.keyword}"/>
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-outline-primary">ê²€ìƒ‰</button>
                    </div>
                </div>
                <!-- ê¸€ì“°ê¸° ë²„íŠ¼ -->
                <a class="btn btn-outline-primary" th:href="@{/community/create}">ê¸€ì“°ê¸°</a>
            </div>

            <!-- í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ë°” -->
            <div class="row mb-3">
                <div class="col-12">
                    <div th:if="${paging.totalRows ne 0}">
                        <nav>
                            <ul class="pagination justify-content-center">
                                <li class="page-item" th:classappend="${paging.first ? 'disabled' : ''}">
                                    <a th:href="@{|/community/houseList?page=${paging.currentPage - 1}|}"
                                       class="page-link" th:onclick="|changePage(${paging.currentPage - 1}, event)|">ì´ì „</a>
                                </li>
                                <th:block th:each="num : ${#numbers.sequence(paging.beginPage, paging.endPage)}">
                                    <li class="page-item" th:classappend="${paging.currentPage == num ? 'active' : ''}">
                                        <a th:href="@{|/community/houseList?page=${num}|}"
                                           class="page-link" th:classappend="${paging.currentPage == num ? 'active' : ''}"
                                           th:text="${num}" th:onclick="|changePage(${num}, event)|"></a>
                                    </li>
                                </th:block>
                                <li class="page-item" th:classappend="${paging.last ? 'disabled' : ''}">
                                    <a th:href="@{|/community/houseList?page=${paging.currentPage + 1}|}"
                                       class="page-link" th:onclick="|changePage(${paging.currentPage + 1}, event)|">ë‹¤ìŒ</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
<script type="text/javascript" layout:fragment="script">
    function changeSort() {
        let form = document.getElementById("form-community");
        form.submit();
    }

    function changePage(page, event) {
        event.preventDefault();
        document.querySelector("input[name=page]").value = page;
        document.getElementById("form-community").submit();
    }
</script>
</html>
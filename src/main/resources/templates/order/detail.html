<html lang="ko" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/base}">
<head>
    <title>ë£¸ë©”ì´í¬ | ì£¼ë¬¸ìƒì„¸</title>
    <style layout:fragment="style">
        .btn.btn-xs {
            --bs-btn-padding-y: .25rem;
            --bs-btn-padding-x: .35rem;
            --bs-btn-font-size: .75rem;
        }

        #myform fieldset {
            display: inline-block;
            direction: rtl;
            border: 0;
        }

        #myform fieldset legend {
            text-align: right;
        }

        #myform input[type=radio] {
            display: none;
        }

        #myform label {
            font-size: 3em;
            color: transparent;
            text-shadow: 0 0 0 #f0f0f0;
        }

        #myform label:hover {
            text-shadow: 0 0 0 rgba(250, 208, 0, 0.99);
        }

        #myform label:hover ~ label {
            text-shadow: 0 0 0 rgba(250, 208, 0, 0.99);
        }

        #myform input[type=radio]:checked ~ label {
            text-shadow: 0 0 0 rgba(250, 208, 0, 0.99);
        }

        #reviewContents {
            width: 100%;
            height: 150px;
            padding: 10px;
            box-sizing: border-box;
            border: solid 1.5px #D3D3D3;
            border-radius: 5px;
            font-size: 16px;
            resize: none;
        }

        /* ìƒë·°ë¦¬ë·° ë³„ì ì„ ë‚˜íƒ€ë‚´ëŠ” css */
        .star_rating {
            width: 100%;
            box-sizing: border-box;
            display: inline-flex;
            float: left;
            flex-direction: row;
            justify-content: flex-start;
        }

        .star_rating .star {
            width: 25px;
            height: 25px;
            margin-right: 10px;
            display: inline-block;
            background: url('https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FE2bww%2FbtsviSSBz4Q%2F5UYnwSWgTlFt6CEFZ1L3Q0%2Fimg.png') no-repeat;
            background-size: 100%;
            box-sizing: border-box;
        }

        .star_rating .star.on {
            width: 25px;
            height: 25px;
            margin-right: 10px;
            display: inline-block;
            background: url('https://blog.kakaocdn.net/dn/b2d6gV/btsvbDoal87/XH5b17uLeEJcBP3RV3FyDk/img.png') no-repeat;
            background-size: 100%;
            box-sizing: border-box;
        }
    </style>
    <link href="/assets/css/star.css" rel="stylesheet"/>
</head>
<div layout:fragment="content" class="container my-3 mt-4">
    <div class="container">
        <div class="row">
            <h4 class="fw-bold text-center mb-4">ì£¼ë¬¸ìƒì„¸</h4>
            <div class="d-flex justify-content-start mb-5 small">
                <div class="me-5">
                    <span class="fw-bold me-1">ì£¼ë¬¸ë²ˆí˜¸</span>
                    <span th:text="${dto.orderId}" class="text-secondary">202404071720583</span>
                </div>
                <div>
                    <span class="fw-bold me-1">ì£¼ë¬¸ì¼ì</span>
                    <span th:text="${#dates.format(dto.createDate, 'yyyy.MM.dd HH:mm')}" class="text-secondary">2024.04.07 14:45</span>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-12 mb-5">
                    <!-- 1. ì£¼ë¬¸ìƒí’ˆ ì˜ì—­ ì‹œì‘ -->
                    <div class="row mb-5">
                        <div class="col-12 mb-5" style="font-size: small">
                            <div class="d-flex justify-content-start align-items-center">
                                <h5 class="fw-bold me-3">ì£¼ë¬¸ìƒí’ˆ <span th:text="${dto.items.size()}">2</span>ê±´</h5>
                                <a th:if="${dto.statusId == 1}"
                                   th:href="@{|/order/claim/cancel-form/${dto.orderId}|}"
                                   class="btn btn-xs btn-outline-secondary me-3">
                                    ì „ì²´ì£¼ë¬¸ì·¨ì†Œ
                                </a>
                                <div th:if="${dto.statusId == 2 or dto.statusId == 3}" style="font-size: 16px; font-weight: bold">
                                    <span class="text-danger">ğŸš€ ì†¡ì¥ë²ˆí˜¸ : </span>
                                    <span th:text="${dto.invoiceNumber}"></span>
                                </div>
                            </div>
                            <hr class="mb-1">
                            <table class="table text-center">
                                <thead>
                                <tr>
                                    <th style="width: 60%">ìƒí’ˆì •ë³´</th>
                                    <th style="width: 5%">ìˆ˜ëŸ‰</th>
                                    <th style="width: 13%">ê°€ê²©</th>
                                    <th style="width: 12%">ì£¼ë¬¸ìƒíƒœ</th>
                                    <th style="width: 10%"></th>
                                </tr>
                                </thead>
                                <tbody class="align-middle">
                                <!-- ì²«ë²ˆì§¸ ìƒí’ˆ ì‹œì‘ -->
                                <tr th:each="item : ${dto.items}">
                                    <!-- ìƒí’ˆì •ë³´ ì˜ì—­ ì‹œì‘ -->
                                    <td>
                                        <div class="d-flex w-100 justify-content-start">
                                            <a th:href="@{/store/detail/{id}(id=${item.productId})}" class="link-underline link-underline-opacity-0 text-dark">
                                                <div>
                                                    <img th:src="@{${item.imageName}}" style="width: 80px; height: 80px">
                                                </div>
                                            </a>
                                            <div class="ms-3 text-start">
                                                <div>
                                                    <div th:text="${item.name}" style="display: -webkit-box;
                                                          overflow: hidden;
                                                          text-overflow: ellipsis;
                                                          -webkit-box-orient: vertical;
                                                          -webkit-line-clamp: 1;">
                                                        LEDì¡°ëª… í†µì„œë ìˆ˜ë‚©ì¹¨ëŒ€ SSQ(ë§¤íŠ¸ë¦¬ìŠ¤ ì„ íƒ)
                                                    </div>
                                                    <div>
                                                        <span th:text="${#numbers.formatInteger(item.price, 1, 'COMMA')}">189,000</span>ì›
                                                    </div>
                                                    <div class="text-secondary mt-2" style="font-size: 12px">
                                                        ì‚¬ì´ì¦ˆ: <span th:text="${item.size}">ìŠˆí¼ì‹±ê¸€SS í”„ë ˆì„ë§Œ</span>
                                                        / ìƒ‰ìƒ: <span th:text="${item.color}">í™”ì´íŠ¸</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <!-- ìƒí’ˆì •ë³´ ì˜ì—­ ë -->
                                    <!-- ì£¼ë¬¸ìƒíƒœ ì˜ì—­ ì‹œì‘ -->
                                    <td><span th:text="${item.amount}">1</span>ê°œ</td>
                                    <td>
                                        <span th:text="${#numbers.formatInteger(item.getItemPrice(), 1, 'COMMA')}">189,000</span>ì›
                                    </td>
                                    <td>
                                        <div>
                                            <div th:text="${item.itemStatusName}">ìƒí’ˆì¤€ë¹„ì¤‘</div>
                                        </div>
                                    </td>
                                    <!-- ì£¼ë¬¸ìƒíƒœ ì˜ì—­ ë -->
                                    <!-- ìš°ì¸¡ ë²„íŠ¼ ì˜ì—­ ì‹œì‘ -->
                                    <!-- 1) ìƒí’ˆì¤€ë¹„ì¤‘ -->
                                    <td th:if="${item.itemStatusId == 1}">
                                        <div>
                                            <a th:href="@{|/order/claim/cancel-form/${dto.orderId}/${item.orderItemId}|}" class="btn btn-xs btn-outline-secondary mb-1">ì£¼ë¬¸ì·¨ì†Œ</a>
                                        </div>
                                    </td>
                                    <!-- 2) ë°°ì†¡ì¤‘-->
                                    <td th:if="${item.itemStatusId == 2}">
                                        <!--<div>
                                            <a th:href="@{#}" type="button" class="btn btn-xs btn-outline-secondary mb-1">ë°°ì†¡ì¡°íšŒ</a>
                                        </div>-->
                                        <div>
                                            <a th:href="@{|/order/claim/return-exchange-form/${dto.orderId}/${item.orderItemId}|}" type="button" class="btn btn-xs btn-outline-secondary mb-1">ë°˜í’ˆ/êµí™˜</a>
                                        </div>
                                    </td>
                                    <!-- 3) ë°°ì†¡ì™„ë£Œ -->
                                    <td th:if="${item.itemStatusId == 3}">
                                        <div>
                                            <button th:id="${'btn-confirm-order-' + item.orderItemId}"
                                                    th:attr="data-order-item-id=${item.orderItemId},
                                                            data-order-id=${item.orderId},
                                                            data-order-item-price=${item.itemPrice}"
                                                    class="btn btn-xs btn-outline-secondary mb-1">
                                                êµ¬ë§¤í™•ì •
                                            </button>
                                        </div>
                                        <!--<div>
                                            <a th:href="@{#}" type="button" class="btn btn-xs btn-outline-secondary mb-1">ë°°ì†¡ì¡°íšŒ</a>
                                        </div>-->
                                        <div>
                                            <a th:href="@{|/order/claim/return-exchange-form/${dto.orderId}/${item.orderItemId}|}" type="button" class="btn btn-xs btn-outline-secondary mb-1">ë°˜í’ˆ/êµí™˜</a>
                                        </div>
                                    </td>
                                    <!-- 4) êµ¬ë§¤í™•ì •-->
                                    <td th:if="${item.itemStatusId == 4}">
                                        <button type="button" id="orderReviewBtn" class="btn btn-xs btn-outline-secondary mb-1" data-bs-toggle="modal" data-bs-target="#exampleModal"
                                                th:attr="data-orderItem-name=${item.name},
                                                         data-orderItem-size=${item.size},
                                                         data-orderItem-color=${item.color},
                                                         data-orderItem-id=${item.orderItemId},
                                                         data-product-id=${item.productId}">
                                            ë¦¬ë·°ì‘ì„±
                                        </button>
                                        <div>
                                            <a th:href="@{|/order/claim/return-exchange-form/${dto.orderId}/${item.orderItemId}|}" type="button" class="btn btn-xs btn-outline-secondary mb-1">ë°˜í’ˆ/êµí™˜</a>
                                        </div>
                                    </td>
                                    <!-- 5) ì·¨ì†Œì™„ë£Œ -->
                                    <td th:if="${item.itemStatusId == 5}">
                                        <div>
                                            <a th:href="@{|/order/claim/cancel-detail/${dto.orderId}|}" type="button" class="btn btn-xs btn-outline-secondary mb-1">ì·¨ì†Œìƒì„¸</a>
                                        </div>
                                    </td>
                                    <!-- 6) ë°˜í’ˆì‹ ì²­-->
                                    <td th:if="${item.itemStatusId == 6}">
                                        <div>
                                            <a th:href="@{|/order/claim/return-detail/${item.orderItemId}|}" type="button" class="btn btn-xs btn-outline-secondary mb-1">ë°˜í’ˆìƒì„¸</a>
                                        </div>
                                        <!--<div>
                                            <a th:href="@{#}" type="button" class="btn btn-xs btn-outline-secondary mb-1">ìˆ˜ê±°ì¡°íšŒ</a>
                                        </div>-->
                                    </td>
                                    <!-- 7) ë°˜í’ˆì™„ë£Œ -->
                                    <td th:if="${item.itemStatusId == 7}">
                                        <div>
                                            <a th:href="@{|/order/claim/return-detail/${item.orderItemId}|}" type="button" class="btn btn-xs btn-outline-secondary mb-1">ë°˜í’ˆìƒì„¸</a>
                                        </div>
                                    </td>
                                    <!-- 8) êµí™˜ì‹ ì²­ -->
                                    <td th:if="${item.itemStatusId == 8}">
                                        <div>
                                            <a th:href="@{|/order/claim/exchange-detail/${item.orderItemId}|}" type="button" class="btn btn-xs btn-outline-secondary mb-1">êµí™˜ìƒì„¸</a>
                                        </div>
                                        <!--<div>
                                            <a th:href="@{#}" type="button" class="btn btn-xs btn-outline-secondary mb-1">ìˆ˜ê±°ì¡°íšŒ</a>
                                        </div>-->
                                        <!--<div>
                                            <a th:href="@{#}" type="button" class="btn btn-xs btn-outline-secondary mb-1">ì¬ë°°ì†¡ì¡°íšŒ</a>
                                        </div>-->
                                    </td>
                                    <!-- 9) êµí™˜ì™„ë£Œ -->
                                    <td th:if="${item.itemStatusId == 9}">
                                        <div>
                                            <a th:href="@{|/order/claim/exchange-detail/${item.orderItemId}|}" type="button" class="btn btn-xs btn-outline-secondary mb-1">êµí™˜ìƒì„¸</a>
                                        </div>
                                        <!--<div>
                                            <a th:href="@{#}" type="button" class="btn btn-xs btn-outline-secondary mb-1">ì¬ë°°ì†¡ì¡°íšŒ</a>
                                        </div>-->
                                    </td>
                                    <!-- ìš°ì¸¡ ë²„íŠ¼ ì˜ì—­ ë -->
                                </tr>
                                </tbody>
                            </table>
                            <div>
                                <ul>
                                    <li>ë°°ì†¡ì§€ ë³€ê²½ì´ë‚˜ ë¶€ë¶„ì·¨ì†Œë¥¼ ì›í•˜ì‹œë©´ ì „ì²´ì£¼ë¬¸ì·¨ì†Œ í›„ ë‹¤ì‹œ ì£¼ë¬¸í•´ì£¼ì„¸ìš”.</li>
                                    <li>ì£¼ë¬¸ì·¨ì†ŒëŠ” ê²°ì œì™„ë£Œ, ìƒí’ˆì¤€ë¹„ì¤‘ ìƒíƒœì—ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
                                    <li>ë°°ì†¡ì™„ë£Œ í›„ 7ì¼ì´ ì§€ë‚œ ê²½ìš°ì—ëŠ” ìë™ìœ¼ë¡œ ìƒí’ˆ êµ¬ë§¤í™•ì •ì´ ì§„í–‰ë©ë‹ˆë‹¤.</li>
                                    <li>êµ¬ë§¤í™•ì • ì‹œ í¬ì¸íŠ¸ê°€ ì ë¦½ë˜ë©°, íšŒì›ë“±ê¸‰ì— ë”°ë¼ ì°¨ë“±ì§€ê¸‰ë©ë‹ˆë‹¤.</li>
                                    <li>ë¦¬ë·° ì‘ì„± ì‹œ 100í¬ì¸íŠ¸ê°€ ì ë¦½ë©ë‹ˆë‹¤.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <!-- ì£¼ë¬¸ìƒí’ˆ ì˜ì—­ ë -->

                    <!-- 2. ë°°ì†¡ì§€ ì •ë³´, ê²°ì œ ì •ë³´ ì˜ì—­ ì‹œì‘ -->
                    <div class="row mb-3">
                        <div class="col-6">
                            <h5 class="fw-bold">ë°°ì†¡ì§€ ì •ë³´</h5>
                            <hr>
                            <div class="d-flex justify-content-start small">
                                <div class="me-5 text-secondary">
                                    <div class="mb-1">ìˆ˜ë ¹ì¸</div>
                                    <div class="mb-1">ì—°ë½ì²˜</div>
                                    <div class="mb-1">ì£¼ì†Œ</div>
                                    <div class="mb-1">ë°°ì†¡ë©”ëª¨</div>
                                </div>
                                <div>
                                    <div id="div-delivery-recipient" th:text="${dto.delivery.recipient}" class="mb-1">ì´*ë©”</div>
                                    <div id="div-delivery-phone" th:text="${dto.delivery.phone}" class="mb-1">010-****-5678</div>
                                    <div class="mb-1">
                                        (<span th:text="${dto.delivery.zipcode}">(03134)</span>)
                                        <span th:text="${dto.delivery.address1}">ì„œìš¸íŠ¹ë³„ì‹œ ì¢…ë¡œêµ¬ ìœ¨ê³¡ë¡œ10ê¸¸ 105</span>
                                        <span id="span-delivery-address" th:text="${dto.delivery.address2}">ë””ì•„ë§ 4F</span>
                                    </div>
                                    <div th:text="${dto.deliveryMemo}" class="mb-1">ë¬¸ ì•ì— ë†“ì•„ì£¼ì„¸ìš”</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <h5 class="fw-bold">ê²°ì œ ì •ë³´</h5>
                            <hr>
                            <div class="mb-3">
                                <div style="font-size: 15px">
                                    <!--<div class="d-flex justify-content-between small mb-1 text-secondary">
                                        <div>ì´ ìƒí’ˆê¸ˆì•¡</div>
                                        <div>334,800ì›</div>
                                    </div>
                                    <div class="d-flex justify-content-between small mb-1 text-secondary">
                                        <div>ì´ í• ì¸ê¸ˆì•¡</div>
                                        <div>- 50,000ì›</div>
                                    </div>-->
                                    <div class="d-flex justify-content-between small mb-1 text-secondary">
                                        <div>í¬ì¸íŠ¸ ì‚¬ìš©</div>
                                        <div><span th:text="${#numbers.formatInteger(dto.usePoint, 1, 'COMMA')}">1,000</span> P</div>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex justify-content-between fw-bold mb-2">
                                <div>ì´ ê²°ì œê¸ˆì•¡</div>
                                <div><span th:text="${#numbers.formatInteger(dto.totalPrice, 1, 'COMMA')}">283,800</span>ì›</div>
                            </div>
                            <div class="d-flex justify-content-between fw-bold mb-5">
                                <div>ê²°ì œìˆ˜ë‹¨</div>
                                <div th:text="${dto.payment.method}">ì¹´ì¹´ì˜¤í˜ì´</div>
                            </div>
                        </div>
                    </div>
                    <!-- ë°°ì†¡ì§€ ì •ë³´, ê²°ì œ ì •ë³´ ì˜ì—­ ë -->
                </div>
            </div>
        </div>
    </div>
    <!-- ì‹ ê·œëŒ“ê¸€ë“±ë¡ ëª¨ë‹¬ì°½ -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">ìƒí’ˆë¦¬ë·°</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <span id="reviewItemName" class="position-relative">ìƒí’ˆì´ë¦„</span>
                    <div class="text-secondary mt-2" style="font-size: 12px">
                        ì‚¬ì´ì¦ˆ: <span id="reviewItemSize">ìŠˆí¼ì‹±ê¸€SS í”„ë ˆì„ë§Œ</span>
                        / ìƒ‰ìƒ: <span id="reviewItemColor">í™”ì´íŠ¸</span>
                    </div>
                    <form class="mb-3 visually" name="myform" id="myform" method="post" enctype="multipart/form-data" action="create">
                        <fieldset>
                            <span class="text-bold">ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”</span>
                            <input type="radio" name="reviewStar" value="5" id="rate1"><label
                                for="rate1">â˜…</label>
                            <input type="radio" name="reviewStar" value="4" id="rate2"><label
                                for="rate2">â˜…</label>
                            <input type="radio" name="reviewStar" value="3" id="rate3"><label
                                for="rate3">â˜…</label>
                            <input type="radio" name="reviewStar" value="2" id="rate4"><label
                                for="rate4">â˜…</label>
                            <input type="radio" name="reviewStar" value="1" id="rate5"><label
                                for="rate5">â˜…</label>
                        </fieldset>
                        <div>
                            <textarea class="col-auto form-control" type="text" id="reviewContents" name="content"
                                      placeholder="ë¦¬ë·°ë¥¼ ì ì–´ì£¼ì„¸ìš”"></textarea>
                        </div>
                        <div class="form-group mb-3">
                            <input type="file" class="form-control" name="imageFile"/>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">ë¦¬ë·°ë“±ë¡</button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript" layout:fragment="script">
    $(function() {
        // êµ¬ë§¤í™•ì •
        $("button[id^=btn-confirm-order]").click(function() {
            let result = confirm("êµ¬ë§¤ë¥¼ í™•ì •í•˜ì‹œê² ì–´ìš”?");
            if (result) {
                let orderId = $(this).attr("data-order-id");
                let orderItemId = $(this).attr("data-order-item-id");
                let orderPrice = $(this).attr("data-order-item-price");
                let url = `/order/confirm` + `/${orderId}` + `/${orderItemId}` + `/${orderPrice}`;
                $.get(url, function(msg) {
                    alert(msg);
                    location.reload();
                })

            }
        });
    });

    // ì´ë¦„ ë§ˆìŠ¤í‚¹ì²˜ë¦¬
    const maskingName = (name) => {
        if (name.length > 2) {
            const originName = name.split('');
            originName.forEach((splitName, i) => {
                if (i === 0 || i === originName.length - 1) {
                    return;
                }
                originName[i] = '*';
            });
            return originName.join('');
        } else {
            const pattern = /.$/;
            return name.replace(pattern, '*');
        }
    };

    let originalName = $("#div-delivery-recipient").text();
    let maskedName = maskingName(originalName);
    $("#div-delivery-recipient").text(maskedName);

    // íœ´ëŒ€í° ë§ˆìŠ¤í‚¹ì²˜ë¦¬
    const maskingPhone = (phone) => {
        return (
            phone.substring(0, 3) +
            '****' +
            phone.substring(phone.length - 4, phone.length)
        );
    };

    let originalPhone = $("#div-delivery-phone").text();
    let maskedPhone = maskingPhone(originalPhone);
    $("#div-delivery-phone").text(maskedPhone);

    // ì£¼ì†Œ ë§ˆìŠ¤í‚¹ì²˜ë¦¬
    const maskingAddress = (address) => {
        if (address.length > 0) {
            return address.replace(/./g, '*');
        } else {
            return '';
        }
    };

    let originalAddress = $("#span-delivery-address").text();
    let maskedAddress = maskingAddress(originalAddress);
    $("#span-delivery-address").text(maskedAddress);

    $("button[id=orderReviewBtn]").click(function() {
        let name = $(this).attr("data-orderItem-name")
        let size = $(this).attr("data-orderItem-size")
        let color = $(this).attr("data-orderItem-color")
        let id = $(this).attr("data-orderItem-id")
        let productId = $(this).attr("data-product-id")
        $("span[id=reviewItemName]").text(name)
        $("span[id=reviewItemSize]").text(size)
        $("span[id=reviewItemColor] ").text(color)
        $("form[id=myform]").attr('action', `/store/replyCreate/${id}/${productId}`)

    })
</script>
</html>
